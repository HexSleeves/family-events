<!DOCTYPE html>
<html lang="en" class="{% if current_user and current_user.theme == 'dark' %}dark{% endif %}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Family Events{% endblock %} - Family Events</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <style>
        /* â”€â”€ Skeleton animation â”€â”€ */
        @keyframes shimmer {
            0%   { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .skeleton {
            background: linear-gradient(90deg, #e5e7eb 25%, #d1d5db 37%, #e5e7eb 63%);
            background-size: 200% 100%;
            animation: shimmer 1.4s ease-in-out infinite;
            border-radius: 4px;
        }
        .dark .skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 37%, #374151 63%);
            background-size: 200% 100%;
        }
        .skeleton-text {
            height: 0.75rem;
            border-radius: 4px;
        }
        .skeleton-text-lg {
            height: 1rem;
            border-radius: 4px;
        }
        .skeleton-badge {
            height: 1.25rem;
            width: 3.5rem;
            border-radius: 9999px;
        }
        .skeleton-score {
            height: 1.75rem;
            width: 2.5rem;
            border-radius: 6px;
        }

        /* â”€â”€ Global top progress bar â”€â”€ */
        @keyframes progress-indeterminate {
            0%   { transform: translateX(-100%); }
            100% { transform: translateX(250%); }
        }
        #global-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 150ms;
            overflow: hidden;
            background: transparent;
        }
        #global-progress.htmx-request {
            opacity: 1;
        }
        #global-progress .bar {
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, #818cf8, #a78bfa, transparent);
            animation: progress-indeterminate 1s ease-in-out infinite;
        }

        /* â”€â”€ HTMX indicator helpers â”€â”€ */
        .htmx-indicator { opacity: 0; transition: opacity 200ms; }
        .htmx-request .htmx-indicator, .htmx-request.htmx-indicator { opacity: 1; }

        /* â”€â”€ Spinner for buttons â”€â”€ */
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            vertical-align: middle;
            margin-left: 4px;
        }

        /* â”€â”€ Skeleton overlay for swap targets â”€â”€ */
        .skeleton-overlay {
            position: absolute;
            inset: 0;
            z-index: 10;
            background: white;
            border-radius: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 150ms;
        }
        .dark .skeleton-overlay {
            background: #1f2937;
        }
        .htmx-request .skeleton-overlay {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
    <script>
        // Auto theme: respect user pref or system
        (function() {
            {% if current_user and current_user.theme == 'auto' %}
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            {% endif %}
        })();
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 leading-relaxed transition-colors" hx-indicator="#global-progress">
    {# Global progress bar #}
    <div id="global-progress"><div class="bar"></div></div>

    <header class="bg-gradient-to-r from-indigo-500 to-purple-500 dark:from-indigo-700 dark:to-purple-700 text-white py-4 mb-6">
        <div class="max-w-4xl mx-auto px-4 flex items-center gap-4">
            <a href="/" class="text-xl font-bold hover:opacity-90 transition">ğŸŒŸ Family Events</a>
            <nav class="ml-auto flex gap-2 items-center">
                <a href="/" class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition">ğŸ  Dashboard</a>
                <a href="/events" class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition">ğŸ“… Events</a>
                <a href="/weekend" class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition">ğŸ‰ Weekend</a>
                <a href="/sources" class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition">ğŸ“¡ Sources</a>
                {% if current_user %}
                <span class="mx-1 text-white/40">|</span>
                <a href="/profile" class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition">ğŸ‘¤ {{ current_user.display_name }}</a>
                <a href="/logout" class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition">â†© Logout</a>
                {% else %}
                <span class="mx-1 text-white/40">|</span>
                <a href="/login" class="px-3 py-1.5 rounded-md bg-white/20 hover:bg-white/30 text-sm font-medium transition">Log In</a>
                <a href="/signup" class="px-3 py-1.5 rounded-md bg-white/30 hover:bg-white/40 text-sm font-medium transition">Sign Up</a>
                {% endif %}
            </nav>
        </div>
    </header>
    <main class="max-w-4xl mx-auto px-4 pb-12">
        {% block content %}{% endblock %}
    </main>
</body>
</html>
