<!doctype html>
<html
  lang="en"
  class="{% if current_user and current_user.theme == 'dark' %}dark{% endif %}"
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Family Events{% endblock %} - Family Events</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <style>
      /* ‚îÄ‚îÄ Skeleton animation ‚îÄ‚îÄ */
      @keyframes shimmer {
        0% {
          background-position: -200% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }
      .skeleton {
        background: linear-gradient(
          90deg,
          #e5e7eb 25%,
          #d1d5db 37%,
          #e5e7eb 63%
        );
        background-size: 200% 100%;
        animation: shimmer 1.4s ease-in-out infinite;
        border-radius: 4px;
      }
      .dark .skeleton {
        background: linear-gradient(
          90deg,
          #374151 25%,
          #4b5563 37%,
          #374151 63%
        );
        background-size: 200% 100%;
      }
      .skeleton-text {
        height: 0.75rem;
        border-radius: 4px;
      }
      .skeleton-text-lg {
        height: 1rem;
        border-radius: 4px;
      }
      .skeleton-badge {
        height: 1.25rem;
        width: 3.5rem;
        border-radius: 9999px;
      }
      .skeleton-score {
        height: 1.75rem;
        width: 2.5rem;
        border-radius: 6px;
      }

      /* ‚îÄ‚îÄ Global top progress bar ‚îÄ‚îÄ */
      @keyframes progress-indeterminate {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(250%);
        }
      }
      #global-progress {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        z-index: 9999;
        opacity: 0;
        transition: opacity 150ms;
        overflow: hidden;
        background: transparent;
      }
      #global-progress.htmx-request {
        opacity: 1;
      }
      #global-progress .bar {
        width: 40%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          #818cf8,
          #a78bfa,
          transparent
        );
        animation: progress-indeterminate 1s ease-in-out infinite;
      }

      /* ‚îÄ‚îÄ HTMX indicator helpers ‚îÄ‚îÄ */
      .htmx-indicator {
        opacity: 0;
        transition: opacity 200ms;
      }
      .htmx-request .htmx-indicator,
      .htmx-request.htmx-indicator {
        opacity: 1;
      }

      /* ‚îÄ‚îÄ Spinner for buttons ‚îÄ‚îÄ */
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .spinner {
        display: inline-block;
        width: 14px;
        height: 14px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        vertical-align: middle;
        margin-left: 4px;
      }

      /* ‚îÄ‚îÄ Toast notifications ‚îÄ‚îÄ */
      @keyframes toast-in {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes toast-out {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
      .toast-enter {
        animation: toast-in 0.3s ease-out forwards;
      }
      .toast-exit {
        animation: toast-out 0.25s ease-in forwards;
      }

      /* ‚îÄ‚îÄ Skeleton overlay for swap targets ‚îÄ‚îÄ */
      .skeleton-overlay {
        position: absolute;
        inset: 0;
        z-index: 10;
        background: white;
        border-radius: 12px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 150ms;
      }
      .dark .skeleton-overlay {
        background: #1f2937;
      }
      .htmx-request .skeleton-overlay {
        opacity: 1;
        pointer-events: auto;
      }
    </style>
    <script>
      // Auto theme: respect user pref or system
      (function() {
          {% if current_user and current_user.theme == 'auto' %}
          if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
              document.documentElement.classList.add('dark');
          }
          {% endif %}
      })();
    </script>
  </head>
  <body
    class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 leading-relaxed transition-colors"
    hx-indicator="#global-progress"
  >
    {# Global progress bar #}
    <div id="global-progress"><div class="bar"></div></div>

    <header
      class="bg-gradient-to-r from-indigo-500 to-purple-500 dark:from-indigo-700 dark:to-purple-700 text-white py-4 mb-6"
    >
      <div class="max-w-4xl mx-auto px-4 flex items-center gap-4">
        <a href="/" class="text-xl font-bold hover:opacity-90 transition"
          >üåü Family Events</a
        >
        <nav class="ml-auto flex gap-2 items-center">
          <a
            href="/"
            class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition"
            >üè† Dashboard</a
          >
          <a
            href="/events"
            class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition"
            >üìÖ Events</a
          >
          <a
            href="/weekend"
            class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition"
            >üéâ Weekend</a
          >
          <a
            href="/sources"
            class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition"
            >üì° Sources</a
          >
          {% if current_user %}
          <span class="mx-1 text-white/40">|</span>
          <a
            href="/profile"
            class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition"
            >üë§ {{ current_user.display_name }}</a
          >
          <a
            href="/logout"
            class="px-3 py-1.5 rounded-md bg-white/15 hover:bg-white/30 text-sm transition"
            >‚Ü© Logout</a
          >
          {% else %}
          <span class="mx-1 text-white/40">|</span>
          <a
            href="/login"
            class="px-3 py-1.5 rounded-md bg-white/20 hover:bg-white/30 text-sm font-medium transition"
            >Log In</a
          >
          <a
            href="/signup"
            class="px-3 py-1.5 rounded-md bg-white/30 hover:bg-white/40 text-sm font-medium transition"
            >Sign Up</a
          >
          {% endif %}
        </nav>
      </div>
    </header>
    <main class="max-w-4xl mx-auto px-4 pb-12">
      {% block content %}{% endblock %}
    </main>

    {# Toast container #}
    <div
      id="toast-container"
      class="fixed flex flex-col gap-2 pointer-events-none"
      style="top:1rem;right:1rem;z-index:10000;max-width:24rem"
    ></div>

    <script>
      (function () {
        var icons = {
          success: "\u2705",
          error: "\u274c",
          warning: "\u26a0\ufe0f",
          info: "\u2139\ufe0f",
        };
        var bgColors = {
          success: "#16a34a",
          error: "#dc2626",
          warning: "#d97706",
          info: "#2563eb",
        };

        function showToast(message, variant, duration) {
          variant = variant || "success";
          duration = duration || 3500;
          var container = document.getElementById("toast-container");
          var el = document.createElement("div");
          el.style.cssText =
            "background:" + (bgColors[variant] || bgColors.success) + ";" +
            "color:#fff;font-size:0.875rem;font-weight:500;" +
            "padding:0.75rem 1rem;border-radius:0.5rem;" +
            "box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);" +
            "pointer-events:auto;cursor:pointer;" +
            "display:flex;align-items:center;gap:0.5rem;";
          el.className = "toast-enter";
          el.innerHTML =
            "<span>" +
            (icons[variant] || "") +
            "</span><span>" +
            message +
            "</span>";
          container.appendChild(el);

          var timer = setTimeout(function () {
            dismiss(el);
          }, duration);
          el.onclick = function () {
            dismiss(el);
          };

          function dismiss(node) {
            clearTimeout(timer);
            node.classList.remove("toast-enter");
            node.classList.add("toast-exit");
            node.addEventListener("animationend", function () {
              node.remove();
            });
          }
        }

        // Listen for HTMX-triggered toast events (from HX-Trigger header)
        document.body.addEventListener("showToast", function (e) {
          var d = e.detail || {};
          showToast(d.message || "Done", d.variant || "success", d.duration);
        });

        // Parse HX-Trigger header from every HTMX response
        document.body.addEventListener("htmx:afterRequest", function (e) {
          var xhr = e.detail.xhr;
          if (!xhr) return;
          var trigger = xhr.getResponseHeader("HX-Trigger");
          if (!trigger) return;
          try {
            var parsed = JSON.parse(trigger);
            if (parsed.showToast) {
              var d = parsed.showToast;
              showToast(d.message || "Done", d.variant || "success", d.duration);
            }
          } catch (err) {
            /* not JSON, ignore */
          }
        });

        window.showToast = showToast;
      })();
    </script>
  </body>
</html>
