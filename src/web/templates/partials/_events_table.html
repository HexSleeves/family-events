{# Events results: card grid + pagination #}

{# Result count #}
<p class="text-sm text-[var(--color-muted)] mb-4">
  Showing {{ (page - 1) * per_page + 1 }}â€“{{ [page * per_page, total] | min }} of {{ total }} events
</p>

{# â•â•â• CARD GRID â•â•â• #}
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
  {% for event in events %}
  {% set score = event.tags.toddler_score if event.tags else none %}
  {% set score_class = "score-low" if score is not none and score <= 3
                  else "score-mid" if score is not none and score <= 6
                  else "score-high" if score is not none and score <= 8
                  else "score-top" if score is not none
                  else "" %}
  {% set score_bg = "score-bg-low" if score is not none and score <= 3
                else "score-bg-mid" if score is not none and score <= 6
                else "score-bg-high" if score is not none and score <= 8
                else "score-bg-top" if score is not none
                else "" %}

  <a href="/event/{{ event.id }}"
     class="group block bg-[var(--color-surface)] rounded-xl border border-[var(--color-edge-subtle)] shadow-[var(--shadow-card)] hover:shadow-[var(--shadow-card-hover)] hover:-translate-y-1 transition-all duration-200 overflow-hidden animate-fade-in-up stagger-{{ [loop.index0 % 8, 9] | min }}">

    {# Image #}
    <div class="relative aspect-[16/10] overflow-hidden">
      {% if event.image_url %}
      <img src="{{ event.image_url }}" alt="{{ event.title }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" loading="lazy" />
      {% else %}
      <div class="img-placeholder w-full h-full text-2xl">
        {% if event.tags and event.tags.categories %}{{ {'play': 'ğŸª', 'nature': 'ğŸŒ³', 'arts': 'ğŸ¨', 'sports': 'âš½', 'animals': 'ğŸ¾', 'music': 'ğŸµ', 'learning': 'ğŸ“š'}.get(event.tags.categories[0], 'ğŸŒŸ') }}{% else %}ğŸŒŸ{% endif %}
      </div>
      {% endif %}

      {# Score badge #}
      {% if score is not none %}
      <div class="absolute top-2.5 left-2.5">
        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-sm font-semibold bg-white/90 backdrop-blur-sm shadow-xs {{ score_class }}">
          {% if score >= 9 %}â­{% endif %}{{ score }}
        </span>
      </div>
      {% endif %}

      {# Free badge #}
      {% if event.is_free %}
      <span class="absolute bottom-2.5 left-2.5 px-2 py-0.5 rounded-full text-xs font-semibold bg-[var(--color-success)] text-white shadow-xs">Free</span>
      {% endif %}
    </div>

    {# Content #}
    <div class="p-3.5">
      <div class="flex items-center gap-2 text-xs text-[var(--color-faint)] mb-1.5">
        <span>{{ event.start_time.strftime('%a %b %d') }}</span>
        <span>Â·</span>
        <span class="capitalize">{{ event.source }}</span>
      </div>
      <h3 class="font-semibold text-[var(--color-heading)] text-sm leading-snug line-clamp-2 group-hover:text-[var(--color-brand)] transition-colors mb-1.5">
        {{ event.title }}
      </h3>
      <p class="text-xs text-[var(--color-muted)] truncate">
        ğŸ“ {{ event.location_name or event.location_city }}, {{ event.location_city }}
      </p>
      {% if event.tags and event.tags.categories %}
      <div class="flex flex-wrap gap-1 mt-2">
        {% for cat in event.tags.categories[:2] %}
        <span class="px-1.5 py-0.5 rounded text-[10px] font-medium bg-[var(--color-surface-tertiary)] text-[var(--color-muted)]">{{ cat }}</span>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </a>
  {% endfor %}
</div>

{# â•â•â• PAGINATION â•â•â• #}
{% if total_pages > 1 %}
<nav class="flex items-center justify-center gap-1 mt-6" aria-label="Pagination">
  {# Previous #}
  {% if page > 1 %}
  <button hx-get="/events?page={{ page - 1 }}&q={{ q }}&city={{ city }}&source={{ source }}&tagged={{ tagged }}&score_min={{ score_min or '' }}&sort={{ sort }}"
          hx-target="#events-results" hx-swap="innerHTML" hx-push-url="true"
          class="min-w-[40px] min-h-[40px] inline-flex items-center justify-center rounded-lg border border-[var(--color-edge)] text-sm text-[var(--color-muted)] hover:bg-[var(--color-surface-tertiary)] hover:text-[var(--color-heading)] transition-colors">
    â†
  </button>
  {% endif %}

  {# Page numbers #}
  {% for p in range(1, total_pages + 1) %}
    {% if p == page %}
    <span class="min-w-[40px] min-h-[40px] inline-flex items-center justify-center rounded-lg bg-[var(--color-brand)] text-white text-sm font-semibold">{{ p }}</span>
    {% elif p == 1 or p == total_pages or (p >= page - 1 and p <= page + 1) %}
    <button hx-get="/events?page={{ p }}&q={{ q }}&city={{ city }}&source={{ source }}&tagged={{ tagged }}&score_min={{ score_min or '' }}&sort={{ sort }}"
            hx-target="#events-results" hx-swap="innerHTML" hx-push-url="true"
            class="min-w-[40px] min-h-[40px] inline-flex items-center justify-center rounded-lg border border-[var(--color-edge)] text-sm text-[var(--color-muted)] hover:bg-[var(--color-surface-tertiary)] hover:text-[var(--color-heading)] transition-colors">
      {{ p }}
    </button>
    {% elif p == 2 or p == total_pages - 1 %}
    <span class="text-[var(--color-faint)] px-1">â€¦</span>
    {% endif %}
  {% endfor %}

  {# Next #}
  {% if page < total_pages %}
  <button hx-get="/events?page={{ page + 1 }}&q={{ q }}&city={{ city }}&source={{ source }}&tagged={{ tagged }}&score_min={{ score_min or '' }}&sort={{ sort }}"
          hx-target="#events-results" hx-swap="innerHTML" hx-push-url="true"
          class="min-w-[40px] min-h-[40px] inline-flex items-center justify-center rounded-lg border border-[var(--color-edge)] text-sm text-[var(--color-muted)] hover:bg-[var(--color-surface-tertiary)] hover:text-[var(--color-heading)] transition-colors">
    â†’
  </button>
  {% endif %}
</nav>
{% endif %}
