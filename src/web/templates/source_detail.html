{% extends "base.html" %}
{% block title %}{{ source.name }}{% endblock %}
{% block content %}

<div class="max-w-4xl mx-auto animate-fade-in">
  <a href="/sources" class="inline-flex items-center gap-1 text-sm text-[var(--color-muted)] hover:text-[var(--color-heading)] mb-4 transition-colors">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
    Back to sources
  </a>

  {# Source info #}
  <div class="bg-[var(--color-surface)] rounded-xl p-6 border border-[var(--color-edge-subtle)] shadow-[var(--shadow-card)] mb-4 animate-fade-in-up">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h1 class="text-2xl font-bold text-[var(--color-heading)] mb-2">{{ source.name }}</h1>
        <p class="text-sm text-[var(--color-muted)] break-all">{{ source.url }}</p>
        <div class="flex items-center gap-3 mt-3 text-sm text-[var(--color-muted)]">
          <span>Status: <strong class="capitalize">{{ source.status }}</strong></span>
          {% if source.last_event_count %}
          <span>· {{ source.last_event_count }} events</span>
          {% endif %}
          {% if source.last_scraped_at %}
          <span>· Last scraped {{ source.last_scraped_at.strftime('%b %d, %I:%M%p') }}</span>
          {% endif %}
        </div>
      </div>
      <div class="flex gap-2 shrink-0">
        <button hx-post="/api/sources/{{ source.id }}/test" hx-target="#detail-result" hx-swap="innerHTML" hx-indicator="#test-spin"
            class="px-4 py-2 rounded-lg bg-[var(--color-brand)] text-white text-sm font-medium hover:bg-[var(--color-brand-hover)] active:scale-[0.98] transition-all flex items-center gap-2">
          Test Scrape <span id="test-spin" class="htmx-indicator spinner"></span>
        </button>
        <button hx-post="/api/sources/{{ source.id }}/analyze" hx-swap="none"
            class="px-4 py-2 rounded-lg border border-[var(--color-edge)] text-[var(--color-muted)] text-sm font-medium hover:bg-[var(--color-surface-tertiary)] hover:text-[var(--color-heading)] transition-colors">
          Re-analyze
        </button>
      </div>
    </div>
  </div>

  {# Recipe info #}
  {% if recipe %}
  <div class="bg-[var(--color-surface)] rounded-xl p-5 border border-[var(--color-edge-subtle)] shadow-[var(--shadow-xs)] mb-4 animate-fade-in-up stagger-1">
    <h3 class="font-semibold text-[var(--color-heading)] mb-3">Scrape Recipe</h3>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
      <div><span class="text-[var(--color-faint)]">Strategy:</span> <strong class="text-[var(--color-heading)] capitalize">{{ recipe.strategy }}</strong></div>
      <div><span class="text-[var(--color-faint)]">Confidence:</span> <strong class="text-[var(--color-heading)]">{{ '%.0f' % (recipe.confidence * 100) }}%</strong></div>
      {% if recipe.analyzed_at %}
      <div><span class="text-[var(--color-faint)]">Analyzed:</span> <strong class="text-[var(--color-heading)]">{{ recipe.analyzed_at.strftime('%b %d') }}</strong></div>
      {% endif %}
    </div>
    {% if recipe.notes %}
    <p class="text-sm text-[var(--color-muted)] mt-3">{{ recipe.notes }}</p>
    {% endif %}
  </div>
  {% endif %}

  {# Test results placeholder #}
  <div id="detail-result" class="animate-fade-in-up stagger-2"></div>

  {# Recent events from source #}
  {% if events %}
  <div class="bg-[var(--color-surface)] rounded-xl p-5 border border-[var(--color-edge-subtle)] shadow-[var(--shadow-xs)] mb-4 animate-fade-in-up stagger-3">
    <h3 class="font-semibold text-[var(--color-heading)] mb-3">Recent Events ({{ events|length }})</h3>
    <div class="space-y-2">
      {% for event in events %}
      <a href="/event/{{ event.id }}" class="flex items-center justify-between p-3 rounded-lg hover:bg-[var(--color-surface-tertiary)] transition-colors">
        <div class="min-w-0">
          <p class="text-sm font-medium text-[var(--color-heading)] truncate">{{ event.title }}</p>
          <p class="text-xs text-[var(--color-muted)]">{{ event.start_time.strftime('%b %d, %I:%M%p') }} · {{ event.location_city }}</p>
        </div>
        {% if event.tags %}
        <span class="text-sm font-bold text-[var(--color-brand)]">{{ event.tags.toddler_score }}/10</span>
        {% endif %}
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

{% endblock %}
