{% extends "base.html" %}
{% block title %}Events{% endblock %}
{% block content %}

<h2 class="text-lg font-semibold mb-4">ðŸ“… All Events ({{ total }})</h2>

{# â”€â”€ Search + Filters â”€â”€ #}
<form
    id="events-form"
    hx-get="/events"
    hx-target="#events-results"
    hx-swap="innerHTML"
    hx-push-url="true"
    hx-trigger="submit, change from:.auto-submit"
    class="bg-white rounded-xl p-4 shadow-sm mb-4 space-y-3"
>
    {# Search bar #}
    <div class="relative">
        <input
            type="text"
            name="q"
            value="{{ q }}"
            placeholder="Search events..."
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent"
            hx-get="/events"
            hx-target="#events-results"
            hx-swap="innerHTML"
            hx-push-url="true"
            hx-trigger="keyup changed delay:300ms"
            hx-include="#events-form"
        />
        <svg class="absolute left-3 top-2.5 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
    </div>

    {# Filter row #}
    <div class="flex flex-wrap gap-3 items-end">
        <div class="flex flex-col">
            <label class="text-xs text-gray-500 font-medium mb-1">City</label>
            <select name="city" class="auto-submit border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-400">
                <option value="">All Cities</option>
                {% for c in cities %}
                <option value="{{ c }}" {{ 'selected' if city == c }}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="flex flex-col">
            <label class="text-xs text-gray-500 font-medium mb-1">Source</label>
            <select name="source" class="auto-submit border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-400">
                <option value="">All Sources</option>
                {% for s in sources %}
                <option value="{{ s }}" {{ 'selected' if source == s }}>{{ s }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="flex flex-col">
            <label class="text-xs text-gray-500 font-medium mb-1">Tagged</label>
            <select name="tagged" class="auto-submit border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-400">
                <option value="">All</option>
                <option value="yes" {{ 'selected' if tagged == 'yes' }}>Tagged</option>
                <option value="no" {{ 'selected' if tagged == 'no' }}>Untagged</option>
            </select>
        </div>
        <div class="flex flex-col">
            <label class="text-xs text-gray-500 font-medium mb-1">Min Score</label>
            <select name="score_min" class="auto-submit border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-400">
                <option value="">Any</option>
                {% for v in range(1, 11) %}
                <option value="{{ v }}" {{ 'selected' if score_min is not none and score_min == v }}>{{ v }}+</option>
                {% endfor %}
            </select>
        </div>
        <div class="flex flex-col">
            <label class="text-xs text-gray-500 font-medium mb-1">Sort</label>
            <select name="sort" class="auto-submit border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-400">
                <option value="start_time" {{ 'selected' if sort == 'start_time' }}>Date â†‘</option>
                <option value="-start_time" {{ 'selected' if sort == '-start_time' }}>Date â†“</option>
                <option value="-score" {{ 'selected' if sort == '-score' }}>Score â†“</option>
                <option value="score" {{ 'selected' if sort == 'score' }}>Score â†‘</option>
                <option value="title" {{ 'selected' if sort == 'title' }}>Title A-Z</option>
                <option value="-title" {{ 'selected' if sort == '-title' }}>Title Z-A</option>
            </select>
        </div>
        {% if q or city or source or tagged or score_min is not none %}
        <a href="/events" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium py-1.5">âœ• Clear filters</a>
        {% endif %}
    </div>

    {# Hidden page field â€” reset to 1 on filter change #}
    <input type="hidden" name="page" value="1" id="page-input" />
</form>

{# â”€â”€ Results (swapped by HTMX) â”€â”€ #}
<div id="events-results">
    {% include "partials/_events_table.html" %}
</div>

{% endblock %}
