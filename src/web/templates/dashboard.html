{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}

{% include "partials/_stats.html" %}

<div class="flex gap-2 mb-6">
    <button
        hx-post="/api/scrape"
        hx-target="#action-status"
        hx-swap="innerHTML"
        hx-indicator="this"
        hx-disabled-elt="this"
        class="inline-flex items-center gap-1 px-4 py-2 rounded-lg bg-indigo-500 hover:bg-indigo-600 text-white font-semibold text-sm cursor-pointer transition disabled:opacity-60 disabled:cursor-wait"
    >
        ğŸ”„ Run Scrapers
        <span class="htmx-indicator"><span class="spinner"></span></span>
    </button>
    <button
        hx-post="/api/tag"
        hx-target="#action-status"
        hx-swap="innerHTML"
        hx-indicator="this"
        hx-disabled-elt="this"
        class="inline-flex items-center gap-1 px-4 py-2 rounded-lg bg-indigo-500 hover:bg-indigo-600 text-white font-semibold text-sm cursor-pointer transition disabled:opacity-60 disabled:cursor-wait"
    >
        ğŸ·ï¸ Tag Events
        <span class="htmx-indicator"><span class="spinner"></span></span>
    </button>
    <button
        hx-post="/api/notify"
        hx-target="#action-status"
        hx-swap="innerHTML"
        hx-indicator="this"
        hx-disabled-elt="this"
        class="inline-flex items-center gap-1 px-4 py-2 rounded-lg bg-indigo-500 hover:bg-indigo-600 text-white font-semibold text-sm cursor-pointer transition disabled:opacity-60 disabled:cursor-wait"
    >
        ğŸ“¬ Send Notification
        <span class="htmx-indicator"><span class="spinner"></span></span>
    </button>
</div>
{# Action result + skeleton loading state #}
<div id="action-status" class="mb-6 relative">
    <div id="action-skeleton" class="htmx-indicator">
        {% include "partials/_skeleton_action.html" %}
    </div>
</div>

<h2 class="text-lg font-semibold mb-4">â­ Top Toddler-Friendly Events</h2>
{% if top_events %}
    {% for e in top_events %}
        {% set event = e %}
        {% set highlight = false %}
        {% set score_display = e.tags.toddler_score %}
        {% set link = none %}
        {% set short_date = false %}
        {% set show_source = true %}
        {% set show_price = false %}
        {% include "partials/_event_card.html" %}
    {% endfor %}
{% else %}
    <p class="text-gray-500 text-sm">No tagged events yet. Run scrapers then tag!</p>
{% endif %}

{% endblock %}
